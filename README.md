# Basic Formatting Utilities

## Overview

This NPM module contains a simple set of utilities to format a JavaScript object into an HTML table as per the screen shot below.

![Screen shot](./img/screenshot.png)

### Behaviour

* Object properties are listed in alphabetic order
* Only object properties of type `Object`, `Array` or `Map` are considered expandable
* By default, expandable object properties will be displayed in a collapsed state
* Click on the expand/collapse button in the `Type` column to hide or display this data.

### But Why?

I wrote this utility primarily to overcome the problem that many standard JavaScript objects (such as an HTTP `request` object or NodeJS's `global` object) contain circular references that cause `JSON.stringify` to explode.

Therefore, rather than resorting to the tedious, trial-and-error approach of repeatedly calling `JSON.stringify` within a `try`/`catch` block, I thought I could achieve a more user-friendly result by writing my own solution.

## Usage

Let's say that for the purposes of debugging, you want to display the contents of some server-side objects in the browser.  In this example, your NodeJS app receives an HTTP request.  Your event handler function is passed `event` and `context` objects and in addition to these, you also want to see inside NodeJS's `process` object.

Your code would look something like this:

```javascript
var utils = require('basic-formatting-utils')
    
var format_response = (evt, ctx) =>
  utils.as_html([],
    utils.as_body([],
      utils.create_content([
        {title: "Context Variables", value: ctx}
      , {title: "Event Variables",   value: evt}
      , {title: "NodeJS process",    value: process}
      ])
    )
  )

// *****************************************************************************
// PUBLIC API
// *****************************************************************************
module.exports = {
  handler: (event, context) => format_response(event, context)
}
```

The coding shown above that packages the response from the call to `create_content` into an HTML `body` element inside an `html` element is optional.  Minimally, you could write something like this:

```javascript
var utils = require('basic-formatting-utils')
    
var object_to_table = (desc, obj_val) => utils.create_content([{title: desc, value: obj_val}])

// *****************************************************************************
// PUBLIC API
// *****************************************************************************
module.exports = {
  show_object: (description, object_value) => object_to_table(description, object_value)
}
```


Typically, this utility will supply its HTML simply as a fragment of the overall Web page generated by some larger app.

The `create_content` function transforms an object into a set of nested HTML tables, but recursively traverses nested objects only down to some predetermined depth.

The default depth is 3, but this can be adjusted by passing a positive integer to `set_depth_limit()`

## API

### Low-level Utilities

| Name | Return Type | Description
|---|---|---|
| `package_version` | `String` | Returns this utility's current package version
| `sizeOf` | `Number` | Returns the number of enumerable elements/properties within an expandable object (see `isExpandable` below). Returns `0` for all other data types

### Datatype Identifiers

| Name | Return Type | Description
|---|---|---|
| `typeOf` | `String` | Returns the actual data type of the object
| `isOfType` | `Function` | Partial function that creates a function to check for a specific data type.<br>E.G. If you want your own type checking function to test for an `ArrayBuffer`, then you could write<pre>var isArrayBuffer = isOfType("ArrayBuffer")</pre>
| `isArray` | `Boolean` | Does exactly what it says on the tin...
| `isBigInt` | `Boolean` | Does exactly what it says on the tin...
| `isExpandable` | `Boolean` | Returns true only for those objects whose content is considered expandable.<br>Currently, this is only true for `Object`, `Array` or `Map`
| `isFunction` | `Boolean` | Does exactly what it says on the tin...
| `isMap` | `Boolean` | Does exactly what it says on the tin...
| `isNull` | `Boolean` | Does exactly what it says on the tin...
| `isNullOrUndef` | `Boolean` | Does exactly what it says on the tin...
| `isNumber` | `Boolean` | Does exactly what it says on the tin...
| `isNumeric` | `Boolean` | Returns true if the argument is either of type `Number` or `BigInt`
| `isObject` | `Boolean` | Returns true both for a standard JavaScript `Object` and the NodeJs objects `process` and `global`.<br>The latter two objects were included in this test because they return their own names when passed to `typeOf()`.  The NodeJS object `WebAssembly` also behaves this way, but is deliberately ignored here.
| `isSymbol` | `Boolean` | Does exactly what it says on the tin...
| `isUndefined` | `Boolean` | Does exactly what it says on the tin...

### HTML Utilities

| Name | Return Type | Description
|---|---|---|
| `as_html_el` | `Function` | A partial function that accepts some HTML tag name such as `p` or `table` or `img` etc., and returns a function requiring two arguments.  See `as_<tag_name>` below.
| `as_<tag_name>` | `String` | <p>A set of functions generated by calling the partial function `as_html_el`.</p><p>E.G. to create a function that generates an HTML paragraph element, you could write:<pre>var as\_p = as\_html\_el("p")</pre>Function `as_p` then requires two parameters:<ol><li>An array of the element's property values.  <br>Pass an empty array if the element does not need any defined properties</li><li>The element's content in a form that is either a string, or where calling that object's `toString()` function returns something useful</li></ol><p>Any content passed to an empty HTML element (such as `img`) will be ignored</p><p>E.G. To generate an HTML `<table>` element where the `border` is defined and all the table rows have been built up in some accumulator array `acc`, the call would be something like:</p><pre>as_table(["border=\\"1\\""], acc.join(""))</pre> 
| `get_depth_limit` | `Number` | Returns the current recursion depth limit for displaying nested objects
| `set_depth_limit` | `Number` | Sets a new recursion depth limit for displaying nested objects. <br>The default depth is 3.

### Main Entry Point

| Name | Return Type | Description
|---|---|---|
| `create_content` | `String` | Takes a single argument of an array of objects, where each object contains the following two properties<ol><li>`title` - Some header text to describe the object.<br>Do not include any formatting or encoded characters in this description as it is used to generate the value of the collapsible `DIV`'s `id` property.</li><li>`value` - The object to be displayed</li></ol>E.G. To display the NodeJS `process` object as shown in the screen shot above, you would write:<pre>create_content([{title: "NodeJS process", value: process}])</pre>Returns a `DIV` element containing the following children:<ol><li>A small style sheet</li><li>One or more `DIV` elements for each received object, each of which contains:<ul><li>The object's title</li><li>The object represented as an HTML table</li></ul></li><li>A small block of JavaScript that:<ul><li>Populates each arrow image's `src` property</li><li>Defines the expand/collapse functions</li></ul></li></ol>
